# Grid Implementation: PDF Export

> **PDF Export** voor het exporteren van Grid data naar PDF formaat.

---

## Overzicht

Bryntum Grid ondersteunt PDF export met custom styling en configuratie.

```
+--------------------------------------------------------------------------+
| GRID                                         [ðŸ“„ Export PDF] [â¬‡ï¸ Download]|
+--------------------------------------------------------------------------+
|  #  |  Name           |  Status     |  Budget      |  Progress    |     |
+--------------------------------------------------------------------------+
|  1  |  Project Alpha  |  Active     |  $50,000     |  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 80%|     |
|  2  |  Project Beta   |  Pending    |  $30,000     |  â–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 40%|     |
|  3  |  Project Gamma  |  Done       |  $45,000     |  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 100%|  |
+--------------------------------------------------------------------------+

                            â†“ Export to PDF â†“

+--------------------------------------------------------------------------+
|  [Logo]        PROJECT REPORT           Date: Dec 27, 2024  Page 1/2    |
+--------------------------------------------------------------------------+
|  #  |  Name           |  Status     |  Budget      |  Progress          |
+--------------------------------------------------------------------------+
|  1  |  Project Alpha  |  Active     |  $50,000     |  80%               |
|  2  |  Project Beta   |  Pending    |  $30,000     |  40%               |
+--------------------------------------------------------------------------+
|                        Generated by Bryntum Grid                         |
+--------------------------------------------------------------------------+
```

---

## 1. Basic PDF Export Setup

### 1.1 Enable PDF Export

```javascript
import { Grid } from '@bryntum/grid';

const grid = new Grid({
    appendTo: 'container',

    features: {
        pdfExport: {
            // Export server URL
            exportServer: 'https://your-server.com/export',

            // Or use client-side export
            clientURL: 'https://your-server.com/export-client'
        }
    },

    columns: [
        { text: 'Name', field: 'name', width: 200 },
        { text: 'Status', field: 'status', width: 120 },
        { text: 'Budget', field: 'budget', type: 'number', format: '$0,000' },
        { text: 'Progress', field: 'progress', type: 'percent', width: 100 }
    ],

    data: [
        { id: 1, name: 'Project Alpha', status: 'Active', budget: 50000, progress: 0.8 },
        { id: 2, name: 'Project Beta', status: 'Pending', budget: 30000, progress: 0.4 }
    ],

    tbar: [
        {
            type: 'button',
            text: 'Export PDF',
            icon: 'b-fa b-fa-file-pdf',
            onClick() {
                grid.features.pdfExport.showExportDialog();
            }
        }
    ]
});
```

---

## 2. Export Configuration

### 2.1 Export Options

```javascript
features: {
    pdfExport: {
        exportServer: 'https://your-server.com/export',

        // Paper size
        paperFormat: 'A4',  // A3, A4, A5, Letter, Legal

        // Orientation
        orientation: 'landscape',  // portrait, landscape

        // Rows per page
        rowsPerPage: 'auto',  // Number or 'auto'

        // Include headers
        repeatHeader: true,

        // File name
        fileName: 'grid-export',

        // Align rows
        alignRows: true,

        // Keep together
        keepPathOnlyRegions: true
    }
}
```

### 2.2 Custom Header and Footer

```javascript
features: {
    pdfExport: {
        exportServer: 'https://your-server.com/export',

        // Header template
        headerTpl: ({ currentPage, totalPages }) => `
            <div style="display: flex; justify-content: space-between; padding: 10px 20px; border-bottom: 2px solid #1976d2;">
                <div>
                    <img src="logo.png" height="30" />
                </div>
                <div style="text-align: right;">
                    <div style="font-size: 18px; font-weight: bold;">Project Report</div>
                    <div style="font-size: 12px; color: #666;">Generated: ${new Date().toLocaleDateString()}</div>
                </div>
            </div>
        `,

        // Footer template
        footerTpl: ({ currentPage, totalPages }) => `
            <div style="display: flex; justify-content: space-between; padding: 10px 20px; border-top: 1px solid #e0e0e0;">
                <div style="font-size: 11px; color: #666;">
                    Confidential - Internal Use Only
                </div>
                <div style="font-size: 11px;">
                    Page ${currentPage} of ${totalPages}
                </div>
            </div>
        `
    }
}
```

---

## 3. Export Methods

### 3.1 Programmatic Export

```javascript
// Show export dialog
grid.features.pdfExport.showExportDialog();

// Export directly
async function exportToPDF() {
    try {
        const result = await grid.features.pdfExport.export({
            paperFormat: 'A4',
            orientation: 'landscape',
            fileName: 'my-export',
            columns: grid.columns.map(c => c.id),  // Export all columns
            rows: grid.store.allRecords  // Export all rows
        });

        console.log('Export successful:', result);
    } catch (error) {
        console.error('Export failed:', error);
    }
}

// Export with custom config
async function exportCustom() {
    const result = await grid.features.pdfExport.export({
        paperFormat: 'A3',
        orientation: 'portrait',
        rowsPerPage: 50,
        repeatHeader: true,
        // Only export visible columns
        columns: grid.columns.visibleColumns.map(c => c.id)
    });
}
```

### 3.2 Export Events

```javascript
grid.on({
    beforePdfExport({ config }) {
        console.log('Starting export with config:', config);
        // Modify config
        config.fileName = `export-${Date.now()}`;
        return true;  // Return false to cancel
    },

    pdfExport({ response }) {
        console.log('Export completed:', response);
    },

    pdfExportFailed({ error }) {
        console.error('Export failed:', error);
    }
});
```

---

## 4. React Integration

```jsx
import { BryntumGrid } from '@bryntum/grid-react';
import { useRef, useMemo, useCallback, useState } from 'react';

function PDFExportGrid({ data }) {
    const gridRef = useRef(null);
    const [isExporting, setIsExporting] = useState(false);

    const handleExportDialog = useCallback(() => {
        const grid = gridRef.current?.instance;
        grid?.features.pdfExport?.showExportDialog();
    }, []);

    const handleExportDirect = useCallback(async () => {
        const grid = gridRef.current?.instance;
        if (!grid) return;

        setIsExporting(true);
        try {
            await grid.features.pdfExport.export({
                paperFormat: 'A4',
                orientation: 'landscape',
                fileName: `report-${new Date().toISOString().split('T')[0]}`
            });
        } catch (error) {
            console.error('Export failed:', error);
        } finally {
            setIsExporting(false);
        }
    }, []);

    const gridConfig = useMemo(() => ({
        features: {
            pdfExport: {
                exportServer: process.env.REACT_APP_EXPORT_SERVER,

                headerTpl: ({ currentPage, totalPages }) => `
                    <div class="pdf-header">
                        <h2>Project Report</h2>
                        <span>Page ${currentPage}/${totalPages}</span>
                    </div>
                `,

                footerTpl: () => `
                    <div class="pdf-footer">
                        <span>Generated: ${new Date().toLocaleString()}</span>
                    </div>
                `
            }
        },

        columns: [
            { text: 'ID', field: 'id', width: 60 },
            { text: 'Name', field: 'name', width: 200 },
            { text: 'Status', field: 'status', width: 100 },
            { text: 'Budget', field: 'budget', type: 'number', format: '$0,000' }
        ],

        listeners: {
            beforePdfExport() {
                setIsExporting(true);
            },
            pdfExport() {
                setIsExporting(false);
            },
            pdfExportFailed() {
                setIsExporting(false);
            }
        }
    }), []);

    return (
        <div className="pdf-export-grid">
            <div className="toolbar">
                <button onClick={handleExportDialog} disabled={isExporting}>
                    <i className="fa fa-file-pdf"></i>
                    Export Dialog
                </button>
                <button onClick={handleExportDirect} disabled={isExporting}>
                    <i className="fa fa-download"></i>
                    {isExporting ? 'Exporting...' : 'Quick Export'}
                </button>
            </div>

            <BryntumGrid
                ref={gridRef}
                data={data}
                {...gridConfig}
            />
        </div>
    );
}
```

---

## 5. Export Server Setup

### 5.1 Server Requirements

```javascript
// Express.js example
const express = require('express');
const puppeteer = require('puppeteer');

const app = express();
app.use(express.json({ limit: '50mb' }));

app.post('/export', async (req, res) => {
    const { html, paperFormat, orientation } = req.body;

    try {
        const browser = await puppeteer.launch();
        const page = await browser.newPage();

        await page.setContent(html, { waitUntil: 'networkidle0' });

        const pdf = await page.pdf({
            format: paperFormat || 'A4',
            landscape: orientation === 'landscape',
            printBackground: true,
            margin: {
                top: '20mm',
                bottom: '20mm',
                left: '10mm',
                right: '10mm'
            }
        });

        await browser.close();

        res.contentType('application/pdf');
        res.send(pdf);
    } catch (error) {
        res.status(500).json({ error: error.message });
    }
});

app.listen(3001);
```

---

## 6. Styling

```css
/* Export dialog */
.b-export-dialog {
    width: 400px;
}

.b-export-dialog .b-field {
    margin-bottom: 16px;
}

/* PDF styles (included in export) */
@media print {
    .pdf-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 16px 24px;
        border-bottom: 2px solid #1976d2;
        background: #f5f5f5;
    }

    .pdf-header h2 {
        margin: 0;
        color: #1976d2;
    }

    .pdf-footer {
        padding: 12px 24px;
        border-top: 1px solid #e0e0e0;
        text-align: center;
        font-size: 11px;
        color: #666;
    }

    /* Ensure colors print */
    .b-grid-cell {
        print-color-adjust: exact;
        -webkit-print-color-adjust: exact;
    }

    /* Status badges */
    .status-active {
        background: #e8f5e9 !important;
        color: #2e7d32 !important;
    }

    .status-pending {
        background: #fff3e0 !important;
        color: #ef6c00 !important;
    }
}

/* Toolbar */
.toolbar {
    display: flex;
    gap: 8px;
    padding: 12px;
    background: #f5f5f5;
    border-bottom: 1px solid #e0e0e0;
}

.toolbar button {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 8px 16px;
    border: 1px solid #e0e0e0;
    background: white;
    cursor: pointer;
    border-radius: 4px;
}

.toolbar button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.toolbar button:hover:not(:disabled) {
    background: #e3f2fd;
}
```

---

## 7. Troubleshooting

| Issue | Oorzaak | Oplossing |
|-------|---------|-----------|
| Export mislukt | Server niet bereikbaar | Check exportServer URL |
| Lege PDF | Content niet geladen | Wait for data load |
| Styling mist | print CSS niet geladen | Voeg print media query toe |
| Grote bestanden | Te veel data | Limiteer rows of use pagination |

---

## API Reference

### PDF Export Config

| Property | Type | Description |
|----------|------|-------------|
| `exportServer` | String | Server URL for export |
| `paperFormat` | String | Paper size (A3, A4, Letter) |
| `orientation` | String | portrait or landscape |
| `headerTpl` | Function | Header template |
| `footerTpl` | Function | Footer template |
| `fileName` | String | Output file name |
| `rowsPerPage` | Number/String | Rows per page |

### Export Methods

| Method | Description |
|--------|-------------|
| `showExportDialog()` | Show export dialog |
| `export(config)` | Export directly |

### Events

| Event | Description |
|-------|-------------|
| `beforePdfExport` | Before export starts |
| `pdfExport` | Export completed |
| `pdfExportFailed` | Export failed |

### Paper Formats

| Format | Size |
|--------|------|
| `A3` | 297 x 420 mm |
| `A4` | 210 x 297 mm |
| `A5` | 148 x 210 mm |
| `Letter` | 8.5 x 11 in |
| `Legal` | 8.5 x 14 in |

---

## Bronnen

- **Feature**: `Grid.feature.PdfExport`
- **Export Dialog**: `Grid.widget.ExportDialog`

---

*Priority 2: Medium Priority Features*
